## 도커 네크워크 구조

도커는 컨테이너 내부 IP를 순타적으로 할당하며, 이 IP는 컨테이너를 재시작할 때마다 변경될 수 있다.
이 내부 IP는 내부 망에서만 쓸 수 있는 IP이므로 외부와 연결이 되어야 한다. 이 과정은 컨테이너를 시작할 떄마다 호스트에 `veth`이라는 네트워크 인터페이스를 생성함으로써 이루어진다. 

도커는 각 컨테이너에 외부와의 네트워크를 제공하기 위해 컨테이너마다 가상 네트워크 인터페이스를 호스트에 생성하며 이 인터페이스의 이름은 `veth`으로 시작한다. 

`veth` 인터페이스는 사용자가 직접 생성할 필요는 없으며 컨테이너가 생성될 때 도커 엔진이 자동으로 생성한다. 

컨테이너를 실행하고 리눅스 사용자라면 `ifconfig`를 명령하면 컨테이너의 수만큼 `veth`로 시작하는 인터페이스가 생성이 된다.

`docker0`라는 브리지도 존재하는데 `docker0` 브리지는 각 `veth` 인터페이스와 바인딩 돼 호스트의 `eth0` 인터페이스와 이어주는 역할을 한다. 

`eth0(container) -> veth... -> docker0 -> eth0(host)`의 구성으로 연뎔이 되어있다. 

`brctl show docker0`을 이용하면 `docker0` 브리지에 실제로 바인딩됐는지 알 수 있다.

## 도터 네트워크 기능

컨테이너를 생성하면 기본적으로 docker0 브리지를 통해 외부와 통신할 수 있는 환경을 사용할 수 있지만 사용자의 선택에 따라 여러 네트워크 드라이버를 쓸 수도 있다. 
도커가 자체적으로 제공하는 대표적인 네트워크 드라이버로는 `bridge`, `host`, `none`, `container`, `overlay`가 잇다. 물론 서드파티들도 존재한다. 

아무런 설정을 하지 않고 컨테이너를 생성하면 컨테이너는 자동으로 `docker0` 브리지를 사용한다.

### 브리지 네트워크

새로운 브리지 네트워크를 생성합니다.

`docker network create --driver bridge [name]`
[name]이라는 브리지 타입의 네트워크가 생성됩니다.

docker run 또는 created에 --net 옵션의 값을 설정하면 컨테이너가 이 네트워크를 사용하도록 설정할 수 있습니다.
```s
docker run -i -it --name [name] \
--net [network_name] \
[image]
```

이렇게 생성된 사용자 정의 네트워크는 `docker network dicconnect, connect`를 통해서 유동적으로 붙이고 뗄 수 있다. 

단 브리지 네트워크, 또는 오버레이 네트워크와 같이 특정 IP 대역을 갖는 네트워크 모드에만 이 명령을 사용할 수 있다.

네트워크의 서브넷, 게이트웨이, IP 할당 범위 등을 임의로 설정하려면 네트워크를 생성할 때 다음 옵션들을 이용하면 된다.

`--subnet` `--ip-range` `--gateway`

단 `--subnet`과 `--ip-range`는 같은 대역이어야 한다.


