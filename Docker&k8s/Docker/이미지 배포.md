이미지를 생성했다면 이를 다른 도커 엔진에 배포할 방법이 필요하다. 

첫 번째 방법은 도커에서 공식적으로 제공하는 도커 허브 이미지 저장소를 사용하는 방법이고, 두 번째 방법은 사설 레지스트리를 사용하는 방법이다.

## 도커 허브 저장소

## 도커 사설 레지스트리

도커 사설 레지스트리를 사용하면 개인 서버레 이미지를 저장할 수 있는 저장소를 만들 수 있다. 이 레지스트리는 컨테이너로서 구현되므로 이에 해당하는 도커 이미지가 존재한다. 이 이미지는 도커에서 공식적으로 제공하고 있기 때문에 아래의 `run` 명령어로 간단히 사용할 수 있다. 

```s
docker run -d --name [container_name] \
-p 5000:5000 \
--restart=always \
registry:2.6
```

`--restart`
컨테이너가 종료되었을 때 재시작에 대한 정책을 설정한다. always는 컨테이너가 정지될 때마다 다시 시작하도록 설정하기 때문에 도커 호스트나 도커 엔진을 재시작해면 컨테이너도 함께 재시작한다.

`--restart`의 다른 입력으로는 `on-failure`와 `unless-stopped`가 있다. `on-failure:5`로 설정하면 컨테이너 종료 코드가 0이 아닐 때 재시작을 5번까지 시도한다. `unless-stopped`는 컨테이너를 `stop` 명령어로 정지했다면 도커 호스트나 도커 엔진을 재시작해도 컨테이너가 시작되지 않도록 설정한다.

### 사설 레지스트리에 이미지 Push하기

`docker tag my-image-name:0:0 ${DOCKER_HOST_IP}:5000/my-image-name:0:0`

push 명령어를 통해서 이미지를 올린다.

`docker push ${DOCKER_HOST_IP}:5000/my-image-name:0:0`

하지만 이미지가 push되지 않는다. 

기본적으로 도커 데몬은 HTTPS를 사용하지 않는 레지스트리 컨테이너에 접근하지 못하도록 설정한다. 여기서는 따로 설정하지 않아도 Push할 수 있도록 설정한다.

다음 옵션을 도커 시작 옵션에 추가한 후 재시작하면 HTTPS를 사용하지 않는 레지스트리 컨테이너에 push, pull할 수 있게 설정한다.

`DOCKER_OPTS="--insecure-registry=${DOCKER_HOST_IP}:5000"`

레지스트리 컨테이너는 생성됨과 동시에 컨테이너 내부 디렉터리에 마운트되는 도커 볼륨을 생성한다. push된 이미지 파일은 이 볼륨에 저장되며 레지스트리 컨테이너가 삭제돼도 볼륨은 남아있게 된다. 컨테이너를 삭제할 때 볼륨도 함께 삭제하고 싶다면 --volume 옵션을 추가한다. 

`docker rm --volume [name]`


